# Storyer - 交互式"穿书"小说体验
## 练手项目...
Storyer是一个基于AI的交互式小说创作与阅读平台，让用户能够"穿越"到自己喜爱的小说中，创造全新的故事线。通过结合大语言模型(LLM)的能力，Storyer能够分析上传的小说，理解其世界观、人物关系和情节发展，然后让用户以角色身份进入故事，创造独特的叙事体验。

## 主要特性

- **小说分析**：自动分析上传的TXT格式小说，提取世界观、人物关系和关键情节
- **角色扮演**：让用户以角色身份进入故事，与小说中的人物互动
- **多模型支持**：同时支持本地Ollama模型和在线API模型
  - 分析模型：用于小说内容分析
  - 写作模型：用于故事续写和角色互动
- **灵活配置**：可自定义API接口、模型参数和叙事窗口设置
- **存档系统**：支持保存和加载游戏进度，随时继续您的故事
- **历史记录**：记录所有对话和故事发展，方便回顾

## 安装与运行

### 前置条件

- Python 3.8+
- 本地Ollama服务（可选，如使用在线API则不需要）
- 在线API访问凭证（可选，如使用本地Ollama则不需要）

### 安装步骤

1. 克隆仓库或下载源码包

```bash
git clone https://github.com/Arain119/Storyer.git
cd Storyer
```

2. 安装依赖

```bash
pip install -r requirements.txt
```

3. 运行应用

```bash
python app.py
```

应用将在 http://127.0.0.1:5000 启动，可通过浏览器访问。

## 配置说明

### API配置

Storyer支持两种模型接入方式：

1. **Ollama本地模型**
   - 需设置Ollama API URL（默认为http://127.0.0.1:11434）
   - 选择已安装的Ollama模型

2. **在线API模型**
   - 需设置API URL和API Key
   - 指定支持的模型名称

### 模型配置

可分别为分析和写作阶段配置不同的模型：

- **分析模型**：用于小说内容分析，推荐使用理解能力强的模型
- **写作模型**：用于故事续写，推荐使用创意写作能力强的模型

### 参数设置

- **温度**：控制输出的随机性，值越高创意性越强
- **Top P**：控制词汇选择的多样性
- **最大令牌数**：控制生成文本的最大长度
- **频率惩罚**：减少重复内容
- **存在惩罚**：增加新内容的可能性

## 使用流程

1. **上传小说**：选择TXT格式的小说文件上传
2. **等待分析**：系统会自动分析小说内容
3. **开始旅程**：分析完成后，点击"开始旅程"进入交互模式
4. **角色互动**：输入您想要的行动，与小说世界互动
5. **保存进度**：随时保存游戏进度，下次可继续

## 常见问题

### 模型选择问题

**问题**：选择在线写作模型但系统使用了本地模型

**解决方案**：确保在选择"在线"类型模型时，系统会自动设置使用在线API

### 分析失败问题

**问题**：小说分析阶段报错"Model does not exist"

**解决方案**：确保分析模型类型（Ollama/在线）与实际API类型匹配

### 性能优化

**问题**：分析大型小说时速度较慢

**解决方案**：
- 使用更强大的本地模型或在线API
- 调整初始上下文章节数和窗口设置

## 项目结构

- `app.py`：主应用入口
- `novel_processor.py`：小说处理与分析
- `narrative_engine.py`：叙事引擎核心
- `ollama_client.py`：Ollama API客户端
- `generic_online_api_client.py`：通用在线API客户端
- `config_manager.py`：配置管理
- `history_manager.py`：历史记录管理
- `save_manager.py`：存档管理
- `prompts.py`：提示词模板
- `utils.py`：通用工具函数

## 许可证

[Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0)

## 贡献指南

欢迎提交问题报告和功能建议。如需贡献代码，请先创建issue讨论您想要更改的内容。

---

*Storyer - 让每个人都能成为自己喜爱小说的主角*
